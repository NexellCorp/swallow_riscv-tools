if { [info exists CHIPNAME] } {
        set  _CHIPNAME $CHIPNAME
} else {
        set  _CHIPNAME nxp4330
}


# Main CPU DAP
if { [info exists DAP_TAPID] } {
        set _DAP_TAPID $DAP_TAPID
} else {
        set _DAP_TAPID 0x4ba00477
}

jtag newtap $_CHIPNAME dap -expected-id $_DAP_TAPID -irlen 4 -ircapture 0x01 -irmask 0xf

set _TARGETNAME0 $_CHIPNAME.cpu0
#set _TARGETNAME1 $_CHIPNAME.cpu1
#set _TARGETNAME2 $_CHIPNAME.cpu2
#set _TARGETNAME3 $_CHIPNAME.cpu3

#target create $_TARGETNAME0 cortex_a -chain-position $_CHIPNAME.dap -coreid 0 -dbgbase 0x80110000 -rtos linux
target create $_TARGETNAME0 cortex_a \
              -chain-position $_CHIPNAME.dap \
              -coreid 0 \
              -dbgbase 0x80110000

#-rtos linux

#target create $_TARGETNAME1 cortex_a -chain-position $_CHIPNAME.dap -coreid 1 -dbgbase 0x80112000
#target create $_TARGETNAME2 cortex_a -chain-position $_CHIPNAME.dap -coreid 2 -dbgbase 0x80114000
#target create $_TARGETNAME3 cortex_a -chain-position $_CHIPNAME.dap -coreid 3 -dbgbase 0x80116000
#target smp $_TARGETNAME0 $_TARGETNAME1 $_TARGETNAME2 $_TARGETNAME3

$_TARGETNAME0 configure -event reset-start { adapter_khz 1000 }
$_TARGETNAME0 configure -event reset-assert-post "nxp4330_dbginit $_TARGETNAME0"
$_TARGETNAME0 configure -event gdb-attach { halt }

# $_TARGETNAME0 configure \
#               -work-area-phys 0x80000000 \
#               -work-area-size 0x4000 \
#               -work-area-backup 0 \
#               -work-area-virt 0xC0088000

proc nxp4330_dbginit {target} {
             cortex_a dbginit
}

# $_TARGETNAME0 configure -event gdb-attach {
#              cortex_a dbginit
# }
# $_TARGETNAME1 configure -event gdb-attach {
#              cortex_a dbginit
# }
# $_TARGETNAME2 configure -event gdb-attach {
#              cortex_a dbginit
# }
# $_TARGETNAME3 configure -event gdb-attach {
#              cortex_a dbginit
# }
